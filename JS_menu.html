<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Tools Menu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .header h1 {
            color: #667eea;
            font-size: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .welcome-text {
            color: #667eea;
            font-weight: 600;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: #f8f9fa;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 999;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            background: #667eea;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid #e9ecef;
        }

        .menu-item:hover {
            background: #e9ecef;
        }

        .menu-item.active {
            background: #667eea;
            color: white;
        }

        .usage-count {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #e9ecef;
            padding: 15px 20px;
            border-top: 1px solid #dee2e6;
        }

        .user-details {
            font-size: 14px;
            color: #6c757d;
        }

        .main-content {
            margin-left: 0;
            margin-top: 80px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .main-content.shifted {
            margin-left: 300px;
        }

        .sidebar-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            margin-right: 15px;
        }

        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 80px);
            padding: 20px;
        }

        .auth-form {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .auth-form h2 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .auth-btn {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .auth-btn:hover {
            background: #5a67d8;
        }

        .auth-links {
            text-align: center;
            margin-top: 20px;
        }

        .auth-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 10px;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .service-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .service-content h2 {
            color: #667eea;
            margin-bottom: 25px;
            text-align: center;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        /* Ripple effect styles */
        .btn {
            position: relative;
            overflow: hidden;
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .video-container {
            text-align: center;
            margin: 20px 0;
        }

        video {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .media-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .media-item img,
        .media-item video {
            max-width: 100%;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .media-item .media-info {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .location-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .location-info h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .location-detail {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                left: -100%;
            }

            .main-content.shifted {
                margin-left: 0;
            }

            .header {
                padding: 10px 15px;
            }

            .header h1 {
                font-size: 1.2rem;
            }

            .user-info {
                flex-direction: column;
                gap: 5px;
            }

            .auth-form {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center;">
            <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
            <h1>🚀 JS Tools Menu</h1>
        </div>
        <div class="user-info hidden" id="userInfo">
            <span class="welcome-text" id="welcomeText"></span>
            <button class="logout-btn" onclick="logout()">Log Out</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Services</h2>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item" onclick="showService('whatsapp')">
                <span>📱 WhatsApp</span>
                <span class="usage-count" id="whatsapp-count">0</span>
            </div>
            <div class="menu-item" onclick="showService('sms')">
                <span>💬 SMS</span>
                <span class="usage-count" id="sms-count">0</span>
            </div>
            <div class="menu-item" onclick="showService('calling')">
                <span>📞 Calling</span>
                <span class="usage-count" id="calling-count">0</span>
            </div>
            <div class="menu-item" onclick="showService('record-video')">
                <span>🎥 Record Video</span>
                <span class="usage-count" id="record-video-count">0</span>
            </div>
            <div class="menu-item" onclick="showService('click-photo')">
                <span>📸 Click Photo</span>
                <span class="usage-count" id="click-photo-count">0</span>
            </div>
            <div class="menu-item" onclick="showService('location')">
                <span>📍 Get My Location</span>
                <span class="usage-count" id="location-count">0</span>
            </div>
            <div class="menu-item" onclick="showService('inventory')">
                <span>📦 Inventory</span>
                <span class="usage-count" id="inventory-count">0</span>
            </div>
        </div>
        <div class="sidebar-footer">
            <div class="user-details" id="sidebarUserDetails"></div>
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <div id="loginForm" class="auth-container">
            <div class="auth-form">
                <h2>🔐 Login</h2>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                    <h4 style="margin: 0 0 10px 0; color: #1976d2;">💡 Quick Login (Default Users)</h4>
                    <p style="margin: 0; font-size: 14px; color: #424242;">
                        <strong>Demo User:</strong> demo@example.com / demo123<br>
                        <strong>Admin:</strong> admin@example.com / admin123<br>
                        <strong>Test User:</strong> test@example.com / test123
                    </p>
                </div>
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="auth-btn">Login</button>
                </form>
                <div class="auth-links">
                    <a href="#" onclick="showRegisterForm()">Create Account</a>
                    <a href="#" onclick="showForgotPasswordForm()">Forgot Password?</a>
                </div>
            </div>
        </div>

        <div id="registerForm" class="auth-container hidden">
            <div class="auth-form">
                <h2>📝 Create Account</h2>
                <form onsubmit="register(event)">
                    <div class="form-group">
                        <label for="registerUsername">Username:</label>
                        <input type="text" id="registerUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email:</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password:</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <button type="submit" class="auth-btn">Create Account</button>
                </form>
                <div class="auth-links">
                    <a href="#" onclick="showLoginForm()">Back to Login</a>
                </div>
            </div>
        </div>

        <div id="forgotPasswordForm" class="auth-container hidden">
            <div class="auth-form">
                <h2>🔑 Reset Password</h2>
                <form onsubmit="resetPassword(event)">
                    <div class="form-group">
                        <label for="resetEmail">Email:</label>
                        <input type="email" id="resetEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password:</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <button type="submit" class="auth-btn">Reset Password</button>
                </form>
                <div class="auth-links">
                    <a href="#" onclick="showLoginForm()">Back to Login</a>
                </div>
            </div>
        </div>

        <div id="serviceContent" class="hidden">
            <div id="whatsapp" class="service-content hidden">
                <h2>📱 Send WhatsApp Message</h2>
                <div class="form-group">
                    <label for="whatsNum">Phone Number:</label>
                    <input type="text" id="whatsNum" placeholder="Enter phone (e.g. +919876543210)">
                </div>
                <div class="form-group">
                    <label for="whatsMsg">Message:</label>
                    <textarea id="whatsMsg" rows="5" placeholder="Enter your message..."></textarea>
                </div>
                <button class="btn" onclick="sendWhatsApp()">Send via WhatsApp</button>
            </div>

            <div id="sms" class="service-content hidden">
                <h2>💬 Send SMS</h2>
                <div class="form-group">
                    <label for="smsNum">Phone Number:</label>
                    <input type="text" id="smsNum" placeholder="Enter phone (e.g. +919876543210)">
                </div>
                <div class="form-group">
                    <label for="smsMsg">Message:</label>
                    <textarea id="smsMsg" rows="5" placeholder="Enter your message..."></textarea>
                </div>
                <button class="btn" onclick="sendSMS()">Send SMS</button>
                <div id="smsStatus" class="status hidden"></div>
            </div>

            <div id="calling" class="service-content hidden">
                <h2>📞 Make a Call</h2>
                <div class="form-group">
                    <label for="callNum">Phone Number:</label>
                    <input type="text" id="callNum" placeholder="Enter phone number">
                </div>
                <button class="btn" onclick="makeCall()">Call</button>
            </div>

            <div id="record-video" class="service-content hidden">
                <h2>🎥 Record Video</h2>
                <div class="video-container">
                    <video id="video" autoplay muted style="display: none;"></video>
                    <video id="recordedVideo" controls style="display: none;"></video>
                </div>
                <div style="text-align: center;">
                    <button class="btn" id="startRecord" onclick="startRecording()">Start Recording</button>
                    <button class="btn btn-danger" id="stopRecord" onclick="stopRecording()" style="display: none;">Stop Recording</button>
                    <button class="btn btn-success" id="saveRecord" onclick="saveRecording()" style="display: none;">Save Video</button>
                </div>
                <div id="recordStatus" class="status hidden"></div>
            </div>

            <div id="click-photo" class="service-content hidden">
                <h2>📸 Click Photo</h2>
                <div class="video-container">
                    <video id="photoVideo" autoplay muted style="display: none;"></video>
                    <canvas id="photoCanvas" style="display: none;"></canvas>
                    <img id="capturedPhoto" style="display: none; max-width: 100%; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);" />
                </div>
                <div style="text-align: center;">
                    <button class="btn" id="startPhoto" onclick="startPhotoCapture()">Start Camera</button>
                    <button class="btn btn-success" id="capturePhoto" onclick="capturePhoto()" style="display: none;">📸 Take Photo</button>
                    <button class="btn" id="downloadPhoto" onclick="downloadPhoto()" style="display: none;">⬇️ Download Photo</button>
                    <button class="btn btn-success" id="savePhoto" onclick="savePhoto()" style="display: none;">💾 Save to Inventory</button>
                </div>
                <div id="photoStatus" class="status hidden"></div>
            </div>

            <div id="location" class="service-content hidden">
                <h2>📍 Get My Location</h2>
                <button class="btn" onclick="getLocation()">Get Location & IP</button>
                <div id="locationStatus" class="status hidden"></div>
                <div id="locationInfo" class="location-info hidden">
                    <h3>Location Information</h3>
                    <div id="locationDetails"></div>
                </div>
            </div>

            <div id="inventory" class="service-content hidden">
                <h2>📦 My Media Inventory</h2>
                <div id="mediaGallery" class="media-gallery"></div>
                <div id="inventoryStatus" class="status hidden"></div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let stream = null;
        let photoStream = null;
        let capturedPhotoData = null;

        document.addEventListener('DOMContentLoaded', function() {
            loadUsersFromFile();
            checkAuthStatus();
            updateUsageCounts();
            addRippleEffect();
        });

        // Load users from the text file
        function loadUsersFromFile() {
            fetch('default_users.txt')
                .then(response => response.text())
                .then(data => {
                    const users = parseUsersFromText(data);
                    localStorage.setItem('users', JSON.stringify(users));
                    console.log('Users loaded from file successfully!');
                })
                .catch(error => {
                    console.log('Could not load users from file, using localStorage only');
                    // If file doesn't exist, use existing localStorage data
                });
        }

        // Parse users from text file content
        function parseUsersFromText(text) {
            const lines = text.split('\n');
            const users = [];
            let currentUser = {};

            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('Username:')) {
                    if (currentUser.username) {
                        users.push(currentUser);
                    }
                    currentUser = {};
                    currentUser.username = line.replace('Username:', '').trim();
                } else if (line.startsWith('Email:')) {
                    currentUser.email = line.replace('Email:', '').trim();
                } else if (line.startsWith('Password:')) {
                    currentUser.password = line.replace('Password:', '').trim();
                }
            }
            
            // Add the last user
            if (currentUser.username && currentUser.email && currentUser.password) {
                users.push(currentUser);
            }

            return users;
        }

        function checkAuthStatus() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user) {
                currentUser = user;
                showAuthenticatedUI();
            } else {
                showLoginForm();
            }
        }

        function showAuthenticatedUI() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.add('hidden');
            document.getElementById('serviceContent').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            
            document.getElementById('welcomeText').textContent = `Welcome, ${currentUser.username}!`;
            document.getElementById('sidebarUserDetails').textContent = `${currentUser.username} (${currentUser.email})`;
            
            showService('whatsapp');
        }

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.add('hidden');
            document.getElementById('serviceContent').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('forgotPasswordForm').classList.add('hidden');
        }

        function showForgotPasswordForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('forgotPasswordForm').classList.remove('hidden');
        }

        function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                localStorage.setItem('currentUser', JSON.stringify(user));
                currentUser = user;
                showAuthenticatedUI();
                initializeUserData();
            } else {
                alert('Invalid email or password!');
            }
        }

        function register(event) {
            event.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            if (users.find(u => u.email === email)) {
                alert('User with this email already exists!');
                return;
            }

            const newUser = { username, email, password };
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Save to text file
            saveUserToFile(newUser);
            
            alert('Account created successfully! Please login.');
            showLoginForm();
        }

        // Save new user to the text file
        function saveUserToFile(newUser) {
            const userEntry = `\nUsername: ${newUser.username}\nEmail: ${newUser.email}\nPassword: ${newUser.password}\n`;
            
            // Create a blob with the new user data
            const blob = new Blob([userEntry], { type: 'text/plain' });
            
            // Create a download link to append to the file
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'new_user.txt';
            link.style.display = 'none';
            
            // Note: Due to browser security restrictions, we can't directly append to existing files
            // This creates a separate file that you can manually merge with default_users.txt
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('New user data ready for file update:', userEntry);
        }

        function resetPassword(event) {
            event.preventDefault();
            const email = document.getElementById('resetEmail').value;
            const newPassword = document.getElementById('newPassword').value;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.email === email);

            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                localStorage.setItem('users', JSON.stringify(users));
                alert('Password reset successfully! Please login with your new password.');
                showLoginForm();
            } else {
                alert('User with this email not found!');
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            showLoginForm();
        }

        function initializeUserData() {
            if (!localStorage.getItem(`usage_${currentUser.email}`)) {
                localStorage.setItem(`usage_${currentUser.email}`, JSON.stringify({
                    whatsapp: 0, sms: 0, calling: 0, 'record-video': 0, 'click-photo': 0, location: 0, inventory: 0
                }));
            }
            if (!localStorage.getItem(`media_${currentUser.email}`)) {
                localStorage.setItem(`media_${currentUser.email}`, JSON.stringify([]));
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('open');
            mainContent.classList.toggle('shifted');
        }

        function showService(serviceName) {
            const services = ['whatsapp', 'sms', 'calling', 'record-video', 'click-photo', 'location', 'inventory'];
            services.forEach(service => {
                document.getElementById(service).classList.add('hidden');
            });

            document.getElementById(serviceName).classList.remove('hidden');

            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            incrementUsage(serviceName);

            if (serviceName === 'inventory') {
                loadInventory();
            }
        }

        function incrementUsage(serviceName) {
            const usageKey = `usage_${currentUser.email}`;
            const usage = JSON.parse(localStorage.getItem(usageKey) || '{}');
            usage[serviceName] = (usage[serviceName] || 0) + 1;
            localStorage.setItem(usageKey, JSON.stringify(usage));
            updateUsageCounts();
        }

        function updateUsageCounts() {
            if (!currentUser) return;
            
            const usageKey = `usage_${currentUser.email}`;
            const usage = JSON.parse(localStorage.getItem(usageKey) || '{}');
            
            Object.keys(usage).forEach(service => {
                const countElement = document.getElementById(`${service}-count`);
                if (countElement) {
                    countElement.textContent = usage[service] || 0;
                }
            });
        }

        function sendWhatsApp() {
            const phone = document.getElementById('whatsNum').value.trim().replace(/\D/g, '');
            const msg = encodeURIComponent(document.getElementById('whatsMsg').value.trim());

            if (!phone || !msg) {
                alert("Please enter both phone number and message.");
                return;
            }

            const url = `https://wa.me/${phone}?text=${msg}`;
            window.open(url, '_blank');
        }

        function sendSMS() {
            const phone = document.getElementById('smsNum').value.trim();
            const message = document.getElementById('smsMsg').value.trim();
            const status = document.getElementById('smsStatus');

            if (!phone || !message) {
                alert("Please enter both phone number and message.");
                return;
            }

            status.textContent = "✅ SMS sent successfully! (Simulated)";
            status.className = "status success";
            status.classList.remove('hidden');
            
            setTimeout(() => {
                status.classList.add('hidden');
            }, 3000);
        }

        function makeCall() {
            const phone = document.getElementById('callNum').value.trim();
            if (!phone) {
                alert("Please enter a phone number.");
                return;
            }

            window.open(`tel:${phone}`, '_blank');
        }

        async function startRecording() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('video').srcObject = stream;
                document.getElementById('video').style.display = 'block';
                document.getElementById('recordedVideo').style.display = 'none';
                
                mediaRecorder = new MediaRecorder(stream);
                recordedChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    document.getElementById('recordedVideo').src = URL.createObjectURL(blob);
                    document.getElementById('recordedVideo').style.display = 'block';
                    document.getElementById('video').style.display = 'none';
                };

                mediaRecorder.start();
                document.getElementById('startRecord').style.display = 'none';
                document.getElementById('stopRecord').style.display = 'inline-block';
                
                showStatus('Recording started...', 'info');
            } catch (error) {
                showStatus('Error accessing camera: ' + error.message, 'error');
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                stream.getTracks().forEach(track => track.stop());
                
                document.getElementById('startRecord').style.display = 'inline-block';
                document.getElementById('stopRecord').style.display = 'none';
                document.getElementById('saveRecord').style.display = 'inline-block';
                
                showStatus('Recording stopped. Click Save to store the video.', 'success');
            }
        }

        function saveRecording() {
            const videoBlob = new Blob(recordedChunks, { type: 'video/webm' });
            const reader = new FileReader();
            
            reader.onload = function() {
                const base64Data = reader.result;
                const mediaKey = `media_${currentUser.email}`;
                const media = JSON.parse(localStorage.getItem(mediaKey) || '[]');
                
                const newMedia = {
                    id: Date.now(),
                    type: 'video',
                    data: base64Data,
                    timestamp: new Date().toISOString(),
                    filename: `video_${Date.now()}.webm`
                };
                
                media.push(newMedia);
                localStorage.setItem(mediaKey, JSON.stringify(media));
                
                showStatus('Video saved successfully!', 'success');
                document.getElementById('saveRecord').style.display = 'none';
            };
            
            reader.readAsDataURL(videoBlob);
        }

        async function getLocation() {
            const status = document.getElementById('locationStatus');
            const locationInfo = document.getElementById('locationInfo');
            const locationDetails = document.getElementById('locationDetails');

            status.textContent = "Getting your location and IP...";
            status.className = "status info";
            status.classList.remove('hidden');

            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const ip = ipData.ip;

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude.toFixed(6);
                            const lon = position.coords.longitude.toFixed(6);
                            
                            locationDetails.innerHTML = `
                                <div class="location-detail">
                                    <strong>IP Address:</strong> ${ip}
                                </div>
                                <div class="location-detail">
                                    <strong>Latitude:</strong> ${lat}°
                                </div>
                                <div class="location-detail">
                                    <strong>Longitude:</strong> ${lon}°
                                </div>
                                <div class="location-detail">
                                    <strong>Accuracy:</strong> ${position.coords.accuracy} meters
                                </div>
                                <div class="location-detail">
                                    <strong>View on Maps:</strong> 
                                    <a href="https://www.google.com/maps?q=${lat},${lon}" target="_blank">Open Google Maps</a>
                                </div>
                            `;
                            
                            locationInfo.classList.remove('hidden');
                            status.textContent = "Location retrieved successfully!";
                            status.className = "status success";
                        },
                        (error) => {
                            status.textContent = "Error getting location: " + error.message;
                            status.className = "status error";
                        }
                    );
                } else {
                    status.textContent = "Geolocation is not supported by your browser.";
                    status.className = "status error";
                }
            } catch (error) {
                status.textContent = "Error getting IP address: " + error.message;
                status.className = "status error";
            }
        }

        function loadInventory() {
            const mediaKey = `media_${currentUser.email}`;
            const media = JSON.parse(localStorage.getItem(mediaKey) || '[]');
            const gallery = document.getElementById('mediaGallery');
            const status = document.getElementById('inventoryStatus');

            if (media.length === 0) {
                status.textContent = "No media items found. Record some videos to see them here!";
                status.className = "status info";
                status.classList.remove('hidden');
                gallery.innerHTML = '';
                return;
            }

            status.classList.add('hidden');
            gallery.innerHTML = '';

            media.forEach(item => {
                const mediaItem = document.createElement('div');
                mediaItem.className = 'media-item';
                
                const mediaElement = item.type === 'video' ? 
                    `<video controls style="max-width: 100%; height: auto;"></video>` :
                    `<img src="${item.data}" alt="Captured media">`;
                
                mediaItem.innerHTML = `
                    ${mediaElement}
                    <div class="media-info">
                        <strong>${item.filename}</strong><br>
                        ${new Date(item.timestamp).toLocaleString()}
                    </div>
                    <button class="btn btn-danger" onclick="deleteMedia(${item.id})">Delete</button>
                `;

                const mediaEl = mediaItem.querySelector('video, img');
                if (item.type === 'video') {
                    mediaEl.src = item.data;
                }

                gallery.appendChild(mediaItem);
            });
        }

        function deleteMedia(mediaId) {
            if (confirm('Are you sure you want to delete this media item?')) {
                const mediaKey = `media_${currentUser.email}`;
                const media = JSON.parse(localStorage.getItem(mediaKey) || '[]');
                const updatedMedia = media.filter(item => item.id !== mediaId);
                localStorage.setItem(mediaKey, JSON.stringify(updatedMedia));
                loadInventory();
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('recordStatus');
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
            
            setTimeout(() => {
                status.classList.add('hidden');
            }, 3000);
        }

        function showPhotoStatus(message, type) {
            const status = document.getElementById('photoStatus');
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
            
            setTimeout(() => {
                status.classList.add('hidden');
            }, 3000);
        }

        // Photo capture functions
        async function startPhotoCapture() {
            try {
                photoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                document.getElementById('photoVideo').srcObject = photoStream;
                document.getElementById('photoVideo').style.display = 'block';
                document.getElementById('capturedPhoto').style.display = 'none';
                
                document.getElementById('startPhoto').style.display = 'none';
                document.getElementById('capturePhoto').style.display = 'inline-block';
                
                showPhotoStatus('Camera started. Click "Take Photo" to capture.', 'info');
            } catch (error) {
                showPhotoStatus('Error accessing camera: ' + error.message, 'error');
            }
        }

        function capturePhoto() {
            const video = document.getElementById('photoVideo');
            const canvas = document.getElementById('photoCanvas');
            const photo = document.getElementById('capturedPhoto');
            
            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Draw video frame to canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Convert to base64
            capturedPhotoData = canvas.toDataURL('image/png');
            
            // Display captured photo
            photo.src = capturedPhotoData;
            photo.style.display = 'block';
            video.style.display = 'none';
            
            // Stop camera stream
            if (photoStream) {
                photoStream.getTracks().forEach(track => track.stop());
            }
            
            // Show download and save buttons
            document.getElementById('capturePhoto').style.display = 'none';
            document.getElementById('downloadPhoto').style.display = 'inline-block';
            document.getElementById('savePhoto').style.display = 'inline-block';
            
            showPhotoStatus('Photo captured successfully!', 'success');
        }

        function downloadPhoto() {
            if (!capturedPhotoData) {
                showPhotoStatus('No photo to download!', 'error');
                return;
            }
            
            const link = document.createElement('a');
            link.download = `photo_${Date.now()}.png`;
            link.href = capturedPhotoData;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showPhotoStatus('Photo downloaded successfully!', 'success');
        }

        function savePhoto() {
            if (!capturedPhotoData) {
                showPhotoStatus('No photo to save!', 'error');
                return;
            }
            
            const mediaKey = `media_${currentUser.email}`;
            const media = JSON.parse(localStorage.getItem(mediaKey) || '[]');
            
            const newMedia = {
                id: Date.now(),
                type: 'image',
                data: capturedPhotoData,
                timestamp: new Date().toISOString(),
                filename: `photo_${Date.now()}.png`
            };
            
            media.push(newMedia);
            localStorage.setItem(mediaKey, JSON.stringify(media));
            
            showPhotoStatus('Photo saved to inventory successfully!', 'success');
            
            // Reset UI
            document.getElementById('downloadPhoto').style.display = 'none';
            document.getElementById('savePhoto').style.display = 'none';
            document.getElementById('startPhoto').style.display = 'inline-block';
            document.getElementById('capturedPhoto').style.display = 'none';
            capturedPhotoData = null;
        }

        // Ripple effect function
        function createRipple(event) {
            const button = event.currentTarget;
            
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;
            
            const rect = button.getBoundingClientRect();
            const x = event.clientX - rect.left - radius;
            const y = event.clientY - rect.top - radius;
            
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${x}px`;
            circle.style.top = `${y}px`;
            circle.classList.add('ripple');
            
            const ripple = button.getElementsByClassName('ripple')[0];
            if (ripple) {
                ripple.remove();
            }
            
            button.appendChild(circle);
            
            // Remove ripple element after animation
            setTimeout(() => {
                if (circle.parentNode) {
                    circle.remove();
                }
            }, 600);
        }

        // Add ripple effect to all buttons
        function addRippleEffect() {
            const buttons = document.querySelectorAll('.btn, .auth-btn, .logout-btn, .sidebar-toggle');
            buttons.forEach(button => {
                button.addEventListener('click', createRipple);
            });
        }

        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.querySelector('.sidebar-toggle');
            
            if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
                sidebar.classList.remove('open');
                document.getElementById('mainContent').classList.remove('shifted');
            }
        });


    </script>
</body>
</html>
